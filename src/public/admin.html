<!DOCTYPE html>
<html lang="pt">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Verificação de Login</title>
  <style>
    .user-info {
      margin: 20px auto;
      padding: 20px;
      border: 1px solid #ddd;
      border-radius: 5px;
      max-width: 400px;
      text-align: center;
      font-family: Arial, sans-serif;
    }
    .user-info img {
      width: 150px;
      height: 150px;
      border-radius: 50%;
      margin-bottom: 15px;
    }
    #verify-message {
      margin-top: 20px;
      padding: 10px;
      border: 1px solid #ff9800;
      background-color: #fff3e0;
      border-radius: 5px;
    }
  </style>
</head>
<body>
  <div class="user-info">
    <h2>Informações do Usuário</h2>
    <img id="user-image" src="" alt="Imagem do Usuário" style="display:none;">
    <p id="user-name">Nome: </p>
    <p id="user-email">Email: </p>
    <p id="user-uid">UID: </p>
    <!-- Área de verificação de e-mail -->
    <div id="verify-message" style="display: none;">
      <p>Seu e-mail não foi verificado.</p>
      <button id="btn-verify" onclick="sendVerificationEmail()">Enviar verificação</button>
    </div>
  </div>

  <!-- Importa os módulos do Firebase -->
  <script type="module">
    // Importações necessárias do Firebase
    import { initializeApp } from "https://www.gstatic.com/firebasejs/9.6.1/firebase-app.js";
    import { getAuth, onAuthStateChanged, sendEmailVerification } from "https://www.gstatic.com/firebasejs/9.6.1/firebase-auth.js";

    // Configuração do Firebase (substitua pelos seus dados, se necessário)
    const firebaseConfig = {
      apiKey: "AIzaSyDWb3xpY7Ft7dIkJmQvJTQIK2dIducFHWA",
      authDomain: "agendou-pro.firebaseapp.com",
      databaseURL: "https://agendou-pro-default-rtdb.firebaseio.com",
      projectId: "agendou-pro",
      storageBucket: "agendou-pro.firebasestorage.app",
      messagingSenderId: "251289108784",
      appId: "1:251289108784:web:f89f926e001932cd9c48f5",
      measurementId: "G-0Z7Z81PLYH"
    };

    // Inicializa o Firebase
    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);

    // Referências aos elementos da página
    const userImage = document.getElementById('user-image');
    const userName  = document.getElementById('user-name');
    const userEmail = document.getElementById('user-email');
    const userUid   = document.getElementById('user-uid');
    const verifyMessageDiv = document.getElementById('verify-message');

    // Função para enviar e-mail de verificação
    window.sendVerificationEmail = () => {
      const user = auth.currentUser;
      if(user) {
        sendEmailVerification(user)
          .then(() => {
            alert("E-mail de verificação enviado. Por favor, verifique sua caixa de entrada.");
          })
          .catch((error) => {
            console.error("Erro ao enviar e-mail de verificação:", error);
            alert("Não foi possível enviar o e-mail de verificação.");
          });
      }
    };

    // Verifica se há usuário autenticado
    onAuthStateChanged(auth, (user) => {
      if (user) {
        console.log("Usuário autenticado:", user);
        userName.textContent = "Nome: " + (user.displayName || "Não informado");
        userEmail.textContent = "Email: " + user.email;
        userUid.textContent = "UID: " + user.uid;

        if (user.photoURL) {
          userImage.src = user.photoURL;
          userImage.style.display = 'block';
        } else {
          userImage.style.display = 'none';
        }

        // Verifica se o e-mail do usuário foi verificado
        if (!user.emailVerified) {
          verifyMessageDiv.style.display = 'block';
        } else {
          verifyMessageDiv.style.display = 'none';
        }
      } else {
        console.log("Nenhum usuário autenticado. Redirecionando para login...");
        window.location.href = "/login"; // ajuste o caminho conforme sua rota de login
      }
    });
  </script>
</body>
</html>
